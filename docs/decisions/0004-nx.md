# Nx

- Status: accepted
- Date: 02-02-2023 18:33:15
- Story: https://github.com/richardblondet/richardblondet.github.io/issues/4

## Decision Outcome

- **Chosen Option:** Nx
- **Rules:** 
  - using with node version LTS 16.19.0
  - managing node versioning with `asdf`. This repo requires file `.tool-versions` with contents:
  ```
  nodejs 16.19.0
  ```
  - using with NPM as package manager
  - initial structure:
  ```
    .
    â”œâ”€â”€ public_html/
    â”‚   â””â”€â”€ ...
    â”œâ”€â”€ docs/
    â”‚   â””â”€â”€ decisions/
    â”‚       â””â”€â”€ ...
    â”œâ”€â”€ apps/
    â”‚   â””â”€â”€ astro_site/
    â”‚       â””â”€â”€ ...
    â”œâ”€â”€ libs/
    â”‚   â”œâ”€â”€ components/
    â”‚   â”‚   â””â”€â”€ ...
    â”‚   â””â”€â”€ functions/
    â”‚       â””â”€â”€ ...
    â”œâ”€â”€ content_data/
    â”‚   â””â”€â”€ astro_collections/
    â”‚       â””â”€â”€ ...
    â””â”€â”€ README.md
  ```


**Disclaimer:** we are choosing nx understanding that we ourselves can potentially be based and opinionated as this tool is. It is very flexible and can clash with stubbornness.


### Consequences

- Order

## Context, Problem Statement and Requirements

- We want to be able to organize our code and repo in a way that allow modularization and separation of concerns
- We want the code to be able to support interoperability 
- We want that tool to help us be productive
- We want that tool to be flexible
- We want a tool that helps us customize
- We want a tool that allow us to grow
- Must support Typescript
- Assumption that we are going to use NPM and what that entails. Must be indicated in rules


## Decision Drivers

- âœ… Opinionated alignment with mental model
- âœ… Not-so-steep learning curve
- âœ… Extendable
- âœ… Typescript && also Prettier, EsLint, Jest, Cypress and more
- âœ… There's a integration tool for envisioned tools like astro but supports React out of the box


## Considered Options

- [Nx](https://nx.dev/)
- [Lerna](https://lerna.js.org/)

### Options Observations

### [Nx](https://nx.dev/)

â€“ âœ… Great for CI/CD
â€“ âœ… Good docs
â€“ âœ… Vscode tool
â€“ âœ… Plugable
â€“ âœ… Caching
â€“ ðŸš« Opinionated
â€“ ðŸš« Extensive configuration filing
â€“ ðŸš« Scary possible deep nesting with files ðŸ‘€
â€“ ðŸš« 437/725 open issues type:bug (meaning Â±60.2% as of 02-02-2023)

### [Lerna](https://lerna.js.org/)

â€“ âœ… Very (very) popular 
â€“ âœ… Package publishing focused
â€“ âœ… Good cache strategies
â€“ âœ… Minimal
â€“ âœ… Concurrent execution
â€“ ðŸš« vscode tool not found
â€“ ðŸš« no plugins

## Links

- https://fyodor.io/nx-based-monorepo-pains-and-gains/
- https://github.com/island-is/island.is/blob/main/handbook/technical-overview/adr/0001-use-nx.md
- https://betterprogramming.pub/why-is-lerna-so-popular-among-developers-ef78d965d3ea
- https://fyodor.io/nx-based-monorepo-pains-and-gains/
